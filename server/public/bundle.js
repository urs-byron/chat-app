(()=>{"use strict";var t={d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Decoder:()=>Zt,Encoder:()=>Qt,PacketType:()=>zt,protocol:()=>Yt});function s(t,...e){return s=this,n=void 0,i=function*(){try{let s;return s=e?yield t(...e):yield t(),s.statusCode>=400?{err:s,data:null}:{err:null,data:s}}catch(t){return console.error(t),{err:t,data:null}}},new((r=void 0)||(r=Promise))((function(t,e){function o(t){try{c(i.next(t))}catch(t){e(t)}}function a(t){try{c(i.throw(t))}catch(t){e(t)}}function c(e){e.done?t(e.value):function(t){return t instanceof r?t:new r((function(e){e(t)}))}(e.value).then(o,a)}c((i=i.apply(s,n||[])).next())}));var s,n,r,i}var n,r=function(t,e,s,n){return new(s||(s=Promise))((function(r,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):function(t){return t instanceof s?t:new s((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};function i(t){return r(this,void 0,void 0,(function*(){let e,s;try{e=yield fetch("/1/auth/login",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","Access-Control-Allow-Credentials":"true"},body:JSON.stringify(t)})}catch(t){return t}try{return s=yield e.json(),s}catch(t){return t}}))}function o(t){return r(this,void 0,void 0,(function*(){let e,s;try{e=yield fetch("/1/auth/register",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","Access-Control-Allow-Credentials":"true"},body:JSON.stringify(t)})}catch(t){return t}try{return s=yield e.json(),s}catch(t){return t}}))}function a(){return r(this,void 0,void 0,(function*(){let t,e;try{t=yield fetch("/1/auth",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})}catch(t){return t}try{return e=yield t.json(),e}catch(t){return t}}))}function c(t){return r(this,void 0,void 0,(function*(){let e,s;try{e=yield fetch("/1/user/search/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){return t}try{return s=yield e.json(),s}catch(t){return t}}))}function h(t){return r(this,void 0,void 0,(function*(){let e,s;try{e=yield fetch("/1/user/settings",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){return t}try{return s=yield e.json(),s}catch(t){}}))}function u(t){return r(this,void 0,void 0,(function*(){let e,s;try{e=yield fetch("/1/user/settings/password",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){return t}try{return s=yield e.json(),s}catch(t){return t}}))}function l(){return r(this,void 0,void 0,(function*(){let t,e;try{t=yield fetch("/1/auth/logout",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})}catch(t){return t}try{return e=yield t.json(),e}catch(t){return t}}))}function d(){return r(this,void 0,void 0,(function*(){let t,e;try{t=yield fetch("/1/user",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})}catch(t){return t}try{return e=yield t.json(),e}catch(t){return t}}))}function p(t){return r(this,void 0,void 0,(function*(){let e,s;try{e=yield fetch("/1/relation",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){return t}try{return s=yield e.json(),s}catch(t){return t}}))}function m(t){return r(this,void 0,void 0,(function*(){let e,s;try{e=yield fetch("/1/relation",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){return t}try{return s=yield e.json(),s}catch(t){return t}}))}function f(t){return r(this,void 0,void 0,(function*(){let e,s;try{e=yield fetch(`/1/group/${t}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})}catch(t){return t}try{return s=yield e.json(),s}catch(t){return t}}))}function g(){return r(this,void 0,void 0,(function*(){let t,e;try{t=yield fetch("/1/group",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})}catch(t){return t}try{return e=yield t.json(),e}catch(t){return t}}))}function y(t){return r(this,void 0,void 0,(function*(){let e,s;try{e=yield fetch("/1/group",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){return t}try{return s=yield e.json(),s}catch(t){return t}}))}function v(t){return r(this,void 0,void 0,(function*(){let e,s;try{e=yield fetch("/1/chat",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){return t}try{return s=yield e.json(),s}catch(t){return t}}))}function b(t){return r(this,void 0,void 0,(function*(){let e,s;try{e=yield fetch(`/1/chat/${t}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})}catch(t){return t}try{return s=yield e.json(),s}catch(t){return t}}))}class R{constructor(t,e,s,n){this.wrapperElement=document.querySelector(t),this.templateElement=document.getElementById(e),this.insertedElement=document.importNode(this.templateElement.content,!0).firstElementChild,n&&this.insertedElement.setAttribute("id",n),this.attachElement(s)}attachElement(t){this.wrapperElement.insertAdjacentElement(t,this.insertedElement)}}class w extends R{constructor(){super(".chat-app","error-temp","afterbegin")}configureComponent(...t){}renderComponent(...t){}}n=w,w.showComp=(t,e)=>{const s=document.querySelector(".error-wrap"),n=document.querySelector(".error-head"),r=document.querySelector(".error-content");n.textContent=t,r.textContent=e?JSON.stringify(e):null,s.classList.remove("hideComp"),s.classList.remove("invisibleElem"),s.classList.add("fadeIn"),setTimeout((()=>{s.classList.add("invisibleElem"),s.classList.remove("fadeIn"),s.classList.add("hideComp")}),5e3)},w.getInstance=()=>(n.instance||(n.instance=new w),n.instance);const E=new RegExp("^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$","g"),I=new RegExp("^[a-zA-Z0-9#?!@$%^&*]{8,20}$"),C="archive",q="block",L="mute",k="user",S="group",T="approve",_="reject",O="cancel",A="public",M="availability";var P;class B{constructor(){}static httpRes(t,e,s){return t.data?!(t.data.statusCode<200||t.data.statusCode>=400)||(w.showComp(`ERROR: ${s}`,t.err),!1):(w.showComp(`ERROR: ${e}`,t.err),!1)}}P=B,B.registerForm=t=>{const e=[t.username.match(I)?null:"Username must contain 8-20 uppercase, lowercase, numeric, or #?!@$%^&* characters",t.password.match(E)?null:"Password must be at least 8 characters long and must contain at least 1 uppercase, lowercase, numeric, and #?!@$%^&* characters",t.rePassword.match(E)?null:"Confirmed password must be at least 8 characters long and must contain at least 1 uppercase, lowercase, numeric, and #?!@$%^&* characters",t.password===t.rePassword?null:"Password & Confirmation password does not match"];return P.setValidity(e)},B.loginForm=t=>{const e=[t.username.trim().length<1?"Username is require":null,t.password.trim().length<1?"Password is require":null];return P.setValidity(e)},B.search=(t,e)=>{const{pattern:s,type:n,skip:r}=t,i=["string"==typeof s?null:"Search Pattern must be astring",0===n||1===n?null:"Search String Types can only be either 1 or 1","user"===e||"group"===e?null:`Search Type can only be either ${k} or ${S}`,"number"==typeof r?null:"Search Skip must be a number"];return P.setValidity(i)},B.changePasswordForm=t=>{const e=[t.password.match(E)?null:"Password must be at least 8 characters long and must contain at least 1 uppercase, lowercase, numeric, and #?!@$%^&* characters",t.rePassword.match(E)?null:"Confirmed password must be at least 8 characters long and must contain at least 1 uppercase, lowercase, numeric, and #?!@$%^&* characters",t.password===t.rePassword?null:"Password & Confirmation password does not match"];return P.setValidity(e)},B.relationAction=t=>{const e=["string"==typeof t.recipientId&&t.recipientId.length>0?null:"Recipient id is required",t.userAction===q||t.userAction===L||t.userAction===C?null:`Relation action must only be ${C}, ${L}, or${q}`,"boolean"==typeof t.actionValue?null:"Relation action value must only be a boolean data type"];return P.setValidity(e)},B.requestDel=(t,e)=>{const s=["string"==typeof t&&t.length>0?null:"Request item id is invalid",0===e||1===e?null:"Request Type is invalid"];return P.setValidity(s)},B.requestItem=(t,e,s)=>{const n=["string"==typeof t.accnt_id&&t.accnt_id.length>0?null:"Request item ID accnt_id is invalid","string"==typeof t.accnt_name&&t.accnt_name.length>0?null:"Request item accnt_name is invalid","boolean"==typeof t.isGroup?null:"Request item type is invalid","approved"===t.status||"cancelled"===t.status||"pending"===t.status||"rejected"===t.status?null:"Request item status can only be 'approved', 'canccelled', or 'rejected'",e instanceof HTMLDivElement?null:"Wrapper must be an HTMLEDivlement","incoming"===s||"outgoing"===s?null:"Request type can only be 'incoming' or 'outgoing'"];return P.setValidity(n)},B.muteBlockItem=(t,e,s)=>{const{accnt_id:n,accnt_name:r}=t,i=["string"==typeof n&&n.length>0?null:(0===s?"Mute":"Block")+"  item requires user ID",e instanceof HTMLDivElement?null:"Wrapper must be an HTMLDivElement","string"==typeof r&&r.length>0?null:(0===s?"Mute":"Block")+"  item requires user ID"];return P.setValidity(i)},B.patchRequestData=(t,e)=>{const{type:s,recipientId:n,groupId:r}=t,i=[e===T||e===_||e===O?null:`Request action must only be ${T},${_}, or ${O}`];return 1===s||2===s||3===s?(2!==s?i.push("string"==typeof n&&n.length>0?null:`Type: ${s} action requires Recipient ID`):i.push(n?`Type: ${s} action requires no Recipient ID`:null),1!==s?i.push("string"==typeof r&&r.length>0?null:`Type: ${s} action requires Group ID`):i.push(r?`Type: ${s} action requires no Group ID`:null)):i.push("Action Type can only be 1, 2, or 3"),P.setValidity(i)},B.approveData=t=>{const e=["approved"===t.newStatus?null:"Status data is invalid"];return P.setValidity(e)},B.privacyData=(t,e)=>{const s=[t.property===e?null:`Privacy property must be ${e}`,"true"===t.value||"false"===t.value?null:"Privacy property value must be a stringified boolean"];return P.setValidity(s)},B.searchItem=t=>{const e=["string"==typeof t.accnt_id&&t.accnt_id.length>0?null:"Account ID is required for a search item","string"==typeof t.act_name&&t.act_name.length>0?null:"Account Name is required for a search item","boolean"==typeof t.availability?null:"Account Name is required for a search item"];return P.setValidity(e)},B.contactItem=t=>{const e=["string"==typeof t.accnt_id&&t.accnt_id.length>0?null:"Account ID is required for a search item","string"==typeof t.accnt_name&&t.accnt_name.length>0?null:"Account Name is required for a search item",t.type===k||t.type===S?null:`Account Type must be either ${k} or ${S}`,"string"==typeof t.chat_id&&t.chat_id.length>0?null:"Account Chat ID is invalid","boolean"==typeof t.admin?null:"Account Admin Property is invalid","boolean"==typeof t.archive?null:"Account Archive Property is invalid","boolean"==typeof t.mute?null:"Account Mute Property is invalid","boolean"==typeof t.block?null:"Account Block Property is invalid","number"==typeof t.bump?null:"Account Bump Property is invalid"];return P.setValidity(e)},B.newGroupInput=t=>{const{recipientId:e,grpName:s}=t,n=["string"==typeof e&&e.length>0?null:"Recipient ID is required","string"==typeof s&&s.length>0?null:"Group name is required"];return P.setValidity(n)},B.setValidity=t=>t.join("")?{isValid:!1,error:t.filter((t=>null!==t))}:{isValid:!0,error:null},B.getInstance=()=>(P.instance||(P.instance=new B),P.instance);var x,U,N=function(t,e,s,n){return new(s||(s=Promise))((function(r,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):function(t){return t instanceof s?t:new s((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class H extends R{constructor(){super(".chat-app","auth-temp","afterbegin"),this.appComp=j.getInstance(),this.submitRegisterFormHandler=t=>N(this,void 0,void 0,(function*(){t.preventDefault();const e=this.getRegisterInput(),n=B.registerForm(e);if(!n.isValid)return w.showComp("ERROR: submitted registration data is invalid",n.error);let r;try{r=yield s(o,e)}catch(t){return w.showComp("ERROR: client is unable to request for registration",t)}B.httpRes(r,"server is unable to process request for registration","server responded with an error upon client's request for registration")&&this.clearRegisterInput()})),this.submitLoginFormHandler=t=>N(this,void 0,void 0,(function*(){t.preventDefault();const e=this.getLoginInput(),n=B.loginForm(e);if(!n.isValid)return w.showComp("ERROR: submitted login data is invalid",n.error);let r;try{r=yield s(i,e)}catch(t){return w.showComp("ERROR: client is unable to request for login",t)}if(B.httpRes(r,"server is unable to process client's request for login","server responded with an error upon client's request for login")){try{yield Be.logUser()}catch(t){return w.showComp("ERROR: client is unable to display user information",t)}this.appComp.appUser(),this.clearLoginInput()}})),this.configureComponent(),this.renderComponent()}configureComponent(){H.authWrap=document.querySelector(".auth-comp"),H.authLoader=document.querySelector(".auth-wrap .loader"),this.regForm=this.insertedElement.querySelector("#register-form"),this.regUsernameInput=document.getElementById("reg-username"),this.regPasswordInput=document.getElementById("reg-password"),this.regRePasswordInput=document.getElementById("reg-rePassword"),this.logForm=this.insertedElement.querySelector("#login-form"),this.logUsernameInput=document.getElementById("log-username"),this.logPasswordInput=document.getElementById("log-password"),this.regForm.addEventListener("submit",this.submitRegisterFormHandler),this.logForm.addEventListener("submit",this.submitLoginFormHandler)}renderComponent(){}getRegisterInput(){return{username:this.regUsernameInput.value,password:this.regPasswordInput.value,rePassword:this.regRePasswordInput.value}}clearRegisterInput(){this.regUsernameInput.value="",this.regPasswordInput.value="",this.regRePasswordInput.value=""}getLoginInput(){return{username:this.logUsernameInput.value,password:this.logPasswordInput.value}}clearLoginInput(){this.logUsernameInput.value="",this.logPasswordInput.value=""}static showComp(){this.authLoader.classList.add("hideElement"),this.authWrap.classList.remove("hideElement")}static hideComp(){this.authLoader.classList.add("hideElement"),this.authWrap.classList.add("hideElement")}static loadingComp(){this.authLoader.classList.remove("hideElement"),this.authWrap.classList.add("hideElement")}}x=H,H.getInstance=()=>(x.instance||(x.instance=new H),x.instance);class j{constructor(){this.chatApp=document.querySelector(".chat-app")}appUser(){this.chatApp.classList.add("chat-app-user-state"),H.hideComp()}appAuth(){H.showComp(),this.chatApp.classList.remove("chat-app-user-state")}}U=j,j.getInstance=()=>(U.instance||(U.instance=new j),U.instance);const D=Object.create(null);D.open="0",D.close="1",D.ping="2",D.pong="3",D.message="4",D.upgrade="5",D.noop="6";const W=Object.create(null);Object.keys(D).forEach((t=>{W[D[t]]=t}));const F={type:"error",data:"parser error"},V="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),G="function"==typeof ArrayBuffer,$=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,J=({type:t,data:e},s,n)=>V&&e instanceof Blob?s?n(e):K(e,n):G&&(e instanceof ArrayBuffer||$(e))?s?n(e):K(new Blob([e]),n):n(D[t]+(e||"")),K=(t,e)=>{const s=new FileReader;return s.onload=function(){const t=s.result.split(",")[1];e("b"+(t||""))},s.readAsDataURL(t)};function Y(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let z;function Q(t,e){return V&&t.data instanceof Blob?t.data.arrayBuffer().then(Y).then(e):G&&(t.data instanceof ArrayBuffer||$(t.data))?e(Y(t.data)):void J(t,!1,(t=>{z||(z=new TextEncoder),e(z.encode(t))}))}const X="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let t=0;t<64;t++)X["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(t)]=t;const Z="function"==typeof ArrayBuffer,tt=(t,e)=>{if("string"!=typeof t)return{type:"message",data:st(t,e)};const s=t.charAt(0);return"b"===s?{type:"message",data:et(t.substring(1),e)}:W[s]?t.length>1?{type:W[s],data:t.substring(1)}:{type:W[s]}:F},et=(t,e)=>{if(Z){const s=(t=>{let e,s,n,r,i,o=.75*t.length,a=t.length,c=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);const h=new ArrayBuffer(o),u=new Uint8Array(h);for(e=0;e<a;e+=4)s=X[t.charCodeAt(e)],n=X[t.charCodeAt(e+1)],r=X[t.charCodeAt(e+2)],i=X[t.charCodeAt(e+3)],u[c++]=s<<2|n>>4,u[c++]=(15&n)<<4|r>>2,u[c++]=(3&r)<<6|63&i;return h})(t);return st(s,e)}return{base64:!0,data:t}},st=(t,e)=>"blob"===e?t instanceof Blob?t:new Blob([t]):t instanceof ArrayBuffer?t:t.buffer,nt=String.fromCharCode(30);let rt;function it(t){if(t)return function(t){for(var e in it.prototype)t[e]=it.prototype[e];return t}(t)}it.prototype.on=it.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},it.prototype.once=function(t,e){function s(){this.off(t,s),e.apply(this,arguments)}return s.fn=e,this.on(t,s),this},it.prototype.off=it.prototype.removeListener=it.prototype.removeAllListeners=it.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r=0;r<n.length;r++)if((s=n[r])===e||s.fn===e){n.splice(r,1);break}return 0===n.length&&delete this._callbacks["$"+t],this},it.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),s=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(s){n=0;for(var r=(s=s.slice(0)).length;n<r;++n)s[n].apply(this,e)}return this},it.prototype.emitReserved=it.prototype.emit,it.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},it.prototype.hasListeners=function(t){return!!this.listeners(t).length};const ot="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function at(t,...e){return e.reduce(((e,s)=>(t.hasOwnProperty(s)&&(e[s]=t[s]),e)),{})}const ct=ot.setTimeout,ht=ot.clearTimeout;function ut(t,e){e.useNativeTimers?(t.setTimeoutFn=ct.bind(ot),t.clearTimeoutFn=ht.bind(ot)):(t.setTimeoutFn=ot.setTimeout.bind(ot),t.clearTimeoutFn=ot.clearTimeout.bind(ot))}class lt extends Error{constructor(t,e,s){super(t),this.description=e,this.context=s,this.type="TransportError"}}class dt extends it{constructor(t){super(),this.writable=!1,ut(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,e,s){return super.emitReserved("error",new lt(t,e,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=tt(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const t=this.opts.hostname;return-1===t.indexOf(":")?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(t){const e=function(t){let e="";for(let s in t)t.hasOwnProperty(s)&&(e.length&&(e+="&"),e+=encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return e}(t);return e.length?"?"+e:""}}const pt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),mt=64,ft={};let gt,yt=0,vt=0;function bt(t){let e="";do{e=pt[t%mt]+e,t=Math.floor(t/mt)}while(t>0);return e}function Rt(){const t=bt(+new Date);return t!==gt?(yt=0,gt=t):t+"."+bt(yt++)}for(;vt<mt;vt++)ft[pt[vt]]=vt;let wt=!1;try{wt="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){}const Et=wt;function It(t){const e=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||Et))return new XMLHttpRequest}catch(t){}if(!e)try{return new(ot[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}function Ct(){}const qt=null!=new It({xdomain:!1}).responseType;class Lt extends it{constructor(t,e){super(),ut(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.data=void 0!==e.data?e.data:null,this.create()}create(){var t;const e=at(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd;const s=this.xhr=new It(e);try{s.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let t in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&s.setRequestHeader(t,this.opts.extraHeaders[t])}}catch(t){}if("POST"===this.method)try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{s.setRequestHeader("Accept","*/*")}catch(t){}null===(t=this.opts.cookieJar)||void 0===t||t.addCookies(s),"withCredentials"in s&&(s.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(s.timeout=this.opts.requestTimeout),s.onreadystatechange=()=>{var t;3===s.readyState&&(null===(t=this.opts.cookieJar)||void 0===t||t.parseCookies(s)),4===s.readyState&&(200===s.status||1223===s.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof s.status?s.status:0)}),0))},s.send(this.data)}catch(t){return void this.setTimeoutFn((()=>{this.onError(t)}),0)}"undefined"!=typeof document&&(this.index=Lt.requestsCount++,Lt.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=Ct,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete Lt.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function kt(){for(let t in Lt.requests)Lt.requests.hasOwnProperty(t)&&Lt.requests[t].abort()}Lt.requestsCount=0,Lt.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",kt):"function"==typeof addEventListener&&addEventListener("onpagehide"in ot?"pagehide":"unload",kt,!1));const St="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),Tt=ot.WebSocket||ot.MozWebSocket,_t="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();function Ot(t,e){return"message"===t.type&&"string"!=typeof t.data&&e[0]>=48&&e[0]<=54}const At={websocket:class extends dt{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,s=_t?{}:at(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=_t?new Tt(t,e,s):e?new Tt(t,e):new Tt(t)}catch(t){return this.emitReserved("error",t)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const s=t[e],n=e===t.length-1;J(s,this.supportsBinary,(t=>{try{this.ws.send(t)}catch(t){}n&&St((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=Rt()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}check(){return!!Tt}},webtransport:class extends dt{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((()=>{this.onClose()})).catch((t=>{this.onError("webtransport error",t)})),this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((t=>{const e=t.readable.getReader();let s;this.writer=t.writable.getWriter();const n=()=>{e.read().then((({done:t,value:e})=>{t||(s||1!==e.byteLength||54!==e[0]?(this.onPacket(function(t,e,s){rt||(rt=new TextDecoder);const n=e||t[0]<48||t[0]>54;return tt(n?t:rt.decode(t),"arraybuffer")}(e,s)),s=!1):s=!0,n())})).catch((t=>{}))};n();const r=this.query.sid?`0{"sid":"${this.query.sid}"}`:"0";this.writer.write((new TextEncoder).encode(r)).then((()=>this.onOpen()))}))})))}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const s=t[e],n=e===t.length-1;Q(s,(t=>{Ot(s,t)&&this.writer.write(Uint8Array.of(54)),this.writer.write(t).then((()=>{n&&St((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}))}}doClose(){var t;null===(t=this.transport)||void 0===t||t.close()}},polling:class extends dt{constructor(t){if(super(t),this.polling=!1,"undefined"!=typeof location){const e="https:"===location.protocol;let s=location.port;s||(s=e?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||s!==t.port}const e=t&&t.forceBase64;this.supportsBinary=qt&&!e,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){((t,e)=>{const s=t.split(nt),n=[];for(let t=0;t<s.length;t++){const r=tt(s[t],e);if(n.push(r),"error"===r.type)break}return n})(t,this.socket.binaryType).forEach((t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((t,e)=>{const s=t.length,n=new Array(s);let r=0;t.forEach(((t,i)=>{J(t,!1,(t=>{n[i]=t,++r===s&&e(n.join(nt))}))}))})(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const t=this.opts.secure?"https":"http",e=this.query||{};return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=Rt()),this.supportsBinary||e.sid||(e.b64=1),this.createUri(t,e)}request(t={}){return Object.assign(t,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Lt(this.uri(),t)}doWrite(t,e){const s=this.request({method:"POST",data:t});s.on("success",e),s.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)})),this.pollXhr=t}}},Mt=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Pt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Bt(t){const e=t,s=t.indexOf("["),n=t.indexOf("]");-1!=s&&-1!=n&&(t=t.substring(0,s)+t.substring(s,n).replace(/:/g,";")+t.substring(n,t.length));let r=Mt.exec(t||""),i={},o=14;for(;o--;)i[Pt[o]]=r[o]||"";return-1!=s&&-1!=n&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(t,e){const s=e.replace(/\/{2,9}/g,"/").split("/");return"/"!=e.slice(0,1)&&0!==e.length||s.splice(0,1),"/"==e.slice(-1)&&s.splice(s.length-1,1),s}(0,i.path),i.queryKey=function(t,e){const s={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,n){e&&(s[e]=n)})),s}(0,i.query),i}class xt extends it{constructor(t,e={}){super(),this.writeBuffer=[],t&&"object"==typeof t&&(e=t,t=null),t?(t=Bt(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=Bt(e.host).host),ut(this,e),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(t){let e={},s=t.split("&");for(let t=0,n=s.length;t<n;t++){let n=s[t].split("=");e[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);const s=Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new At[t](s)}open(){let t;if(this.opts.rememberUpgrade&&xt.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(t=>this.onClose("transport close",t)))}probe(t){let e=this.createTransport(t),s=!1;xt.priorWebsocketSuccess=!1;const n=()=>{s||(e.send([{type:"ping",data:"probe"}]),e.once("packet",(t=>{if(!s)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;xt.priorWebsocketSuccess="websocket"===e.name,this.transport.pause((()=>{s||"closed"!==this.readyState&&(h(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}))}else{const t=new Error("probe error");t.transport=e.name,this.emitReserved("upgradeError",t)}})))};function r(){s||(s=!0,h(),e.close(),e=null)}const i=t=>{const s=new Error("probe error: "+t);s.transport=e.name,r(),this.emitReserved("upgradeError",s)};function o(){i("transport closed")}function a(){i("socket closed")}function c(t){e&&t.name!==e.name&&r()}const h=()=>{e.removeListener("open",n),e.removeListener("error",i),e.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};e.once("open",n),e.once("error",i),e.once("close",o),this.once("close",a),this.once("upgrading",c),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==t?this.setTimeoutFn((()=>{s||e.open()}),200):e.open()}onOpen(){if(this.readyState="open",xt.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let s=0;s<this.writeBuffer.length;s++){const n=this.writeBuffer[s].data;if(n&&(t+="string"==typeof(e=n)?function(t){let e=0,s=0;for(let n=0,r=t.length;n<r;n++)e=t.charCodeAt(n),e<128?s+=1:e<2048?s+=2:e<55296||e>=57344?s+=3:(n++,s+=4);return s}(e):Math.ceil(1.33*(e.byteLength||e.size))),s>0&&t>this.maxPayload)return this.writeBuffer.slice(0,s);t+=2}var e;return this.writeBuffer}write(t,e,s){return this.sendPacket("message",t,e,s),this}send(t,e,s){return this.sendPacket("message",t,e,s),this}sendPacket(t,e,s,n){if("function"==typeof e&&(n=e,e=void 0),"function"==typeof s&&(n=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const r={type:t,data:e,options:s};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),n&&this.once("flush",n),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},s=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?s():t()})):this.upgrading?s():t()),this}onError(t){xt.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const e=[];let s=0;const n=t.length;for(;s<n;s++)~this.transports.indexOf(t[s])&&e.push(t[s]);return e}}xt.protocol=4,xt.protocol;const Ut="function"==typeof ArrayBuffer,Nt=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Ht=Object.prototype.toString,jt="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Ht.call(Blob),Dt="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Ht.call(File);function Wt(t){return Ut&&(t instanceof ArrayBuffer||Nt(t))||jt&&t instanceof Blob||Dt&&t instanceof File}function Ft(t,e){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let e=0,s=t.length;e<s;e++)if(Ft(t[e]))return!0;return!1}if(Wt(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return Ft(t.toJSON(),!0);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&Ft(t[e]))return!0;return!1}function Vt(t){const e=[],s=t.data,n=t;return n.data=Gt(s,e),n.attachments=e.length,{packet:n,buffers:e}}function Gt(t,e){if(!t)return t;if(Wt(t)){const s={_placeholder:!0,num:e.length};return e.push(t),s}if(Array.isArray(t)){const s=new Array(t.length);for(let n=0;n<t.length;n++)s[n]=Gt(t[n],e);return s}if("object"==typeof t&&!(t instanceof Date)){const s={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=Gt(t[n],e));return s}return t}function $t(t,e){return t.data=Jt(t.data,e),delete t.attachments,t}function Jt(t,e){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let s=0;s<t.length;s++)t[s]=Jt(t[s],e);else if("object"==typeof t)for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(t[s]=Jt(t[s],e));return t}const Kt=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Yt=5;var zt;!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(zt||(zt={}));class Qt{constructor(t){this.replacer=t}encode(t){return t.type!==zt.EVENT&&t.type!==zt.ACK||!Ft(t)?[this.encodeAsString(t)]:this.encodeAsBinary({type:t.type===zt.EVENT?zt.BINARY_EVENT:zt.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}encodeAsString(t){let e=""+t.type;return t.type!==zt.BINARY_EVENT&&t.type!==zt.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=Vt(t),s=this.encodeAsString(e.packet),n=e.buffers;return n.unshift(s),n}}function Xt(t){return"[object Object]"===Object.prototype.toString.call(t)}class Zt extends it{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const s=e.type===zt.BINARY_EVENT;s||e.type===zt.BINARY_ACK?(e.type=s?zt.EVENT:zt.ACK,this.reconstructor=new te(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!Wt(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const s={type:Number(t.charAt(0))};if(void 0===zt[s.type])throw new Error("unknown packet type "+s.type);if(s.type===zt.BINARY_EVENT||s.type===zt.BINARY_ACK){const n=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const r=t.substring(n,e);if(r!=Number(r)||"-"!==t.charAt(e))throw new Error("Illegal attachments");s.attachments=Number(r)}if("/"===t.charAt(e+1)){const n=e+1;for(;++e&&","!==t.charAt(e)&&e!==t.length;);s.nsp=t.substring(n,e)}else s.nsp="/";const n=t.charAt(e+1);if(""!==n&&Number(n)==n){const n=e+1;for(;++e;){const s=t.charAt(e);if(null==s||Number(s)!=s){--e;break}if(e===t.length)break}s.id=Number(t.substring(n,e+1))}if(t.charAt(++e)){const n=this.tryParse(t.substr(e));if(!Zt.isPayloadValid(s.type,n))throw new Error("invalid payload");s.data=n}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(t){return!1}}static isPayloadValid(t,e){switch(t){case zt.CONNECT:return Xt(e);case zt.DISCONNECT:return void 0===e;case zt.CONNECT_ERROR:return"string"==typeof e||Xt(e);case zt.EVENT:case zt.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===Kt.indexOf(e[0]));case zt.ACK:case zt.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class te{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=$t(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function ee(t,e,s){return t.on(e,s),function(){t.off(e,s)}}const se=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class ne extends it{constructor(t,e,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[ee(t,"open",this.onopen.bind(this)),ee(t,"packet",this.onpacket.bind(this)),ee(t,"error",this.onerror.bind(this)),ee(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(se.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const s={type:zt.EVENT,data:e,options:{}};if(s.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){const t=this.ids++,n=e.pop();this._registerAckCallback(t,n),s.id=t}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)||(this.connected?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(t,e){var s;const n=null!==(s=this.flags.timeout)&&void 0!==s?s:this._opts.ackTimeout;if(void 0===n)return void(this.acks[t]=e);const r=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error("operation has timed out"))}),n);this.acks[t]=(...t)=>{this.io.clearTimeoutFn(r),e.apply(this,[null,...t])}}emitWithAck(t,...e){const s=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((n,r)=>{e.push(((t,e)=>s?t?r(t):n(e):n(t))),this.emit(t,...e)}))}_addToQueue(t){let e;"function"==typeof t[t.length-1]&&(e=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push(((t,...n)=>{if(s===this._queue[0])return null!==t?s.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(t)):(this._queue.shift(),e&&e(null,...n)),s.pending=!1,this._drainQueue()})),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||0===this._queue.length)return;const e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth((t=>{this._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:zt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case zt.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case zt.EVENT:case zt.BINARY_EVENT:this.onevent(t);break;case zt.ACK:case zt.BINARY_ACK:this.onack(t);break;case zt.DISCONNECT:this.ondisconnect();break;case zt.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const s of e)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&"string"==typeof t[t.length-1]&&(this._lastOffset=t[t.length-1])}ack(t){const e=this;let s=!1;return function(...n){s||(s=!0,e.packet({type:zt.ACK,id:t,data:n}))}}onack(t){const e=this.acks[t.id];"function"==typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t),this.packet(t)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:zt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const s of e)s.apply(this,t.data)}}}function re(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}re.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),s=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-s:t+s}return 0|Math.min(t,this.max)},re.prototype.reset=function(){this.attempts=0},re.prototype.setMin=function(t){this.ms=t},re.prototype.setMax=function(t){this.max=t},re.prototype.setJitter=function(t){this.jitter=t};class ie extends it{constructor(t,s){var n;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(s=t,t=void 0),(s=s||{}).path=s.path||"/socket.io",this.opts=s,ut(this,s),this.reconnection(!1!==s.reconnection),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=s.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new re({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==s.timeout?2e4:s.timeout),this._readyState="closed",this.uri=t;const r=s.parser||e;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==s.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new xt(this.uri,this.opts);const e=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const n=ee(e,"open",(function(){s.onopen(),t&&t()})),r=e=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",e),t?t(e):this.maybeReconnectOnOpen()},i=ee(e,"error",r);if(!1!==this._timeout){const t=this._timeout,s=this.setTimeoutFn((()=>{n(),r(new Error("timeout")),e.close()}),t);this.opts.autoUnref&&s.unref(),this.subs.push((()=>{this.clearTimeoutFn(s)}))}return this.subs.push(n),this.subs.push(i),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(ee(t,"ping",this.onping.bind(this)),ee(t,"data",this.ondata.bind(this)),ee(t,"error",this.onerror.bind(this)),ee(t,"close",this.onclose.bind(this)),ee(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(t){this.onclose("parse error",t)}}ondecoded(t){St((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new ne(this,t,e),this.nsps[t]=s),s}_destroy(t){const e=Object.keys(this.nsps);for(const t of e)if(this.nsps[t].active)return;this._close()}_packet(t){const e=this.encoder.encode(t);for(let s=0;s<e.length;s++)this.engine.write(e[s],t.options)}cleanup(){this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn((()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()})))}),e);this.opts.autoUnref&&s.unref(),this.subs.push((()=>{this.clearTimeoutFn(s)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const oe={};function ae(t,e){"object"==typeof t&&(e=t,t=void 0);const s=function(t,e="",s){let n=t;s=s||"undefined"!=typeof location&&location,null==t&&(t=s.protocol+"//"+s.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?s.protocol+t:s.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==s?s.protocol+"//"+t:"https://"+t),n=Bt(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port+e,n.href=n.protocol+"://"+r+(s&&s.port===n.port?"":":"+n.port),n}(t,(e=e||{}).path||"/socket.io"),n=s.source,r=s.id,i=s.path,o=oe[r]&&i in oe[r].nsps;let a;return e.forceNew||e["force new connection"]||!1===e.multiplex||o?a=new ie(n,e):(oe[r]||(oe[r]=new ie(n,e)),a=oe[r]),s.query&&!e.query&&(e.query=s.queryKey),a.socket(s.path,e)}Object.assign(ae,{Manager:ie,Socket:ne,io:ae,connect:ae});var ce,he=function(t,e,s,n){return new(s||(s=Promise))((function(r,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):function(t){return t instanceof s?t:new s((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class ue{constructor(t,e){this.peerId=t,this.type=e,this.userGroups=[],this.submitMembershipRequest=t=>{var e;let s;for(s of ue.requestStack)null===(e=Ae.socket)||void 0===e||e.emit(Ae.postRequestEv,s)},this.submitNewGroup=t=>he(this,void 0,void 0,(function*(){var e;t.preventDefault();const n={recipientId:this.chatMsgs.dataset.userId?this.chatMsgs.dataset.userId:"",grpName:this.groupsInput.value},r=B.newGroupInput(n);if(!r.isValid)return w.showComp("ERROR: client's new group request data is invalid",r.error);let i;try{i=yield s(y,n)}catch(t){return w.showComp("ERROR: client is unable to request for user groups",t)}let o=B.httpRes(i,"server is unable to process request for submitting new group","server responded with an error upon client's request for user groups");if(!o)return;const a=i.data.data.group_id,c=this.createRequestBody(this.chatMsgs.dataset.userId,a);null===(e=Ae.socket)||void 0===e||e.emit(Ae.postRequestEv,c),o=B.httpRes(i,"server is unable to process request for user membership","server responded with an error upon client's request for user membership"),o&&(this.groupsInput.value="")})),(()=>{he(this,void 0,void 0,(function*(){try{yield this.getGroups(),this.configureComponent(),this.renderComponent()}catch(t){w.showComp("ERROR: client is unable to get user groups",t)}}))})()}configureComponent(...t){ue.sPeerId=this.peerId,ue.groupsWrap=document.querySelector(".chat-msg-groups"),this.groupRequestBtn=document.querySelector(".chat-msg-groups-head i"),this.groupsForm=document.querySelector(".chat-msg-group-new"),this.groupsInput=document.querySelector(".chat-msg-group-new input"),this.chatMsgs=document.querySelector(".chat-msgs"),this.groupRequestBtn.addEventListener("click",this.submitMembershipRequest),this.groupsForm.addEventListener("submit",this.submitNewGroup)}renderComponent(...t){this.generateGroups()}getGroups(){return he(this,void 0,void 0,(function*(){const t=sessionStorage.getItem(ue.grpSessionStoreName);if(t&&Array.isArray(JSON.parse(t)))return void(this.userGroups=JSON.parse(t));let e;try{e=yield s(g)}catch(t){return w.showComp("ERROR: client is unable to get user groups",t)}B.httpRes(e,"server is unable to process request for user groups","server responded with an error upon client's request for user groups")&&(this.userGroups=e.data.data,sessionStorage.setItem(ue.grpSessionStoreName,JSON.stringify(this.userGroups)))}))}generateGroups(){if("group"===this.type)return;let t;for(t of this.userGroups)t.accnt_id!==this.peerId&&ue.createGroupItem(t,ue.groupsWrap)}createRequestBody(t,e){return{type:3,recipientId:t,groupId:e}}static createRequestBody(t,e){return{type:3,recipientId:e,groupId:t}}}ce=ue,ue.requestStack=[],ue.grpSessionStoreName="sessionGroups",ue.addMembershipRequest=t=>{const e=t.currentTarget,s=e.dataset.grpId;e.classList.toggle("chat-msg-group-action-undo"),e.classList.contains("chat-msg-group-action-undo")?ce.requestStack.push(ue.createRequestBody(s,ue.sPeerId)):ce.requestStack=ce.requestStack.filter((t=>t.groupId!==s))},ue.createGroupItem=(t,e)=>{const s=document.createElement("div");s.classList.add("chat-msg-group-item");const n=document.createElement("h4");n.textContent=t.accnt_name;const r=document.createElement("div");r.classList.add("chat-msg-group-action");const i=document.createElement("span");i.textContent="undo";const o=document.createElement("i");o.classList.add("fa-solid","fa-plus"),r.appendChild(i),r.appendChild(o),r.dataset.grpId=t.accnt_id,s.appendChild(n),s.appendChild(r),e.appendChild(s),r.addEventListener("click",ue.addMembershipRequest)},ue.getInstance=(t,e,s)=>(s?ce.instance=null:ce.instance||(ce.instance=new ue(t,e)),ce.instance);var le,de=function(t,e,s,n){return new(s||(s=Promise))((function(r,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):function(t){return t instanceof s?t:new s((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class pe extends R{constructor(t,e,n,r,i,o){super(".chat-msgs","msgs-list-temp","afterbegin"),this.userId=t,this.peerId=e,this.peerName=n,this.chatId=r,this.availability=i,this.type=o,this.skip=0,this.skipCnt=30,this.msgsId=null,this.msgsLists=new Map,this.msgsListCnt=0,this.incrMsgsListCnt=(t=1)=>{this.msgsListCnt++},this.clickMsgOptsBtnHandler=t=>{this.chatMsgModal.classList.toggle("chat-msg-group-modal-show-state")},this.clickMsgBtnRequestHandler=t=>{var e;const s=pe.createRequestBody(this.chatMsgsForms.dataset.chatType,this.peerId);null===(e=Ae.socket)||void 0===e||e.emit(Ae.postRequestEv,s)},this.submitMessageHandler=t=>{t.preventDefault();const e=t.target.querySelector("input"),s={msg:e.value,msgId:crypto.randomUUID().replace(/-/g,""),chatId:this.chatId,senderName:"You",senderId:this.userId,timeReceived:0};Ae.socket.emit(Ae.postMessageEv,s,this.peerId,this.type,(t=>{"msg"in t?(pe.createMsgItem(t,pe.chatMsgBody,pe.chatMsgsListWrap,0),Se.updatePeerListHTML({accnt_id:this.peerId,chat_id:t.chatId},t),this.msgsListCnt=this.msgsListCnt+1,pe.setMsgListInfo(this.chatId,t,null),pe.chatMsgsListWrap.scrollTop=pe.chatMsgsListWrap.scrollHeight):w.showComp("ERROR: server failed to send message",JSON.stringify(t))})),e.value=""},this.getMoreMessages=t=>de(this,void 0,void 0,(function*(){const e=t.target;let n;const r=this.getChatReqBody();if(0!==e.scrollTop)return;const i=pe.getMsgListInfoCount(this.chatId);if(this.skip*this.skipCnt>i)return;const o=e.scrollHeight;try{n=yield s(v,r)}catch(t){return w.showComp("ERROR: client is unable to fetch chat messages",t)}if(!B.httpRes(n,"server error occured","client responded with an error for upon request for chat messages"))return;if(null===n.data.data)return;const a=n.data.data.msgs;null!==a&&Array.isArray(a)&&a.length&&(this.generateMsgItems(this.userId,a),this.skip++,this.msgsListCnt=this.msgsListCnt+a.length,pe.setMsgListInfo(this.chatId,null,a),e.scrollTop=e.scrollHeight-o)})),this.generateMsgItems=(t,e)=>{let s;if(null!==e&&Array.isArray(e)&&e.length)for(s of e)pe.createMsgItem(s,pe.chatMsgBody,pe.chatMsgsListWrap,t===s.senderId?0:1,!0)},(()=>{de(this,void 0,void 0,(function*(){const s=pe.getMsgListInfoCount(this.chatId);if(s){this.msgsListCnt=s;const t=Math.floor(s/this.skipCnt);this.skip=t}else yield this.getMessages();this.configureComponent(),this.renderComponent(t,e,n,r,i,o)}))})()}configureComponent(){pe.sPeerId=this.peerId,pe.chatMsgsListWrap=document.querySelector(".chat-msg-body-wrap"),pe.chatMsgsListWrap.dataset.chatId=this.chatId,pe.chatMsgBody=document.querySelector("#chat-msg-body"),this.chatMsgHead=document.querySelector(".chat-msg-head"),this.chatMsgHeadName=document.querySelector(".chat-msg-head-name h2"),this.chatListGrpBtnWrap=document.querySelector(".chat-msg-head-opts-btn"),this.chatListGrpBtn=document.querySelector(".chat-msg-head-opts-btn i"),this.chatMsgsForms=document.querySelector(".chat-msg-forms"),this.chatMsgRequest=document.querySelector(".chat-msg-request"),this.chatMsgForm=document.querySelector(".chat-msg-form"),this.chatMsgModal=document.querySelector(".chat-msg-group-modal"),this.modalGroupInput=document.querySelector(".chat-msg-group-new input"),this.chatMsgRequest.addEventListener("click",this.clickMsgBtnRequestHandler),this.chatMsgForm.addEventListener("submit",this.submitMessageHandler),pe.chatMsgsListWrap.addEventListener("scroll",this.getMoreMessages)}renderComponent(t,e,s,n,r,i){this.chatMsgsForms.dataset.peerId=e,this.chatMsgsForms.dataset.chatType=i,this.chatMsgHeadName.textContent=s,"group"===this.type&&this.chatMsgHead.removeChild(this.chatListGrpBtnWrap),r?this.chatListGrpBtn.addEventListener("click",this.clickMsgOptsBtnHandler):(this.chatListGrpBtn.classList.add("chat-msg-head-opts-btn-unavailable-state"),pe.chatMsgsListWrap.scrollTop=pe.chatMsgsListWrap.scrollHeight,this.chatMsgsForms.classList.add("chat-msg-form-request-state")),"user"===i&&ue.getInstance(e,i,!1),this.generateMsgItems(t,JSON.parse(sessionStorage.getItem(pe.sessionStoreListKey+this.chatId))),pe.chatMsgsListWrap.scrollTop=pe.chatMsgsListWrap.scrollHeight}getMessages(){return de(this,void 0,void 0,(function*(){let t;const e=this.getChatReqBody();try{t=yield s(v,e)}catch(t){return w.showComp("ERROR: client is unable to fetch chat messages",t)}B.httpRes(t,"server error occured","client responded with an error for upon request for chat messages")&&(this.skip++,this.msgsId=t.data.data.msgsId,null!==t.data.data.msgs&&Array.isArray(t.data.data.msgs)&&t.data.data.msgs.length&&(this.msgsListCnt=t.data.data.msgs.length),pe.setMsgListInfo(this.chatId,null,t.data.data.msgs))}))}static createRequestBody(t,e){return{type:"user"===t?1:2,recipientId:"user"===t?e:null,groupId:"group"===t?e:null}}getChatReqBody(){return{skip:this.skip,type:this.type,chatId:this.chatId,listCnt:this.msgsListCnt}}}le=pe,pe.myMsgClass="chat-msg-others",pe.peerMsgClass="chat-msg-mine",pe.sessionStoreListKey="msgList",pe.getChatMsgsListWrap=()=>le.chatMsgsListWrap,pe.getChatMsgBody=()=>le.chatMsgBody,pe.getMsgListInfoCount=t=>{const e=JSON.parse(sessionStorage.getItem(le.sessionStoreListKey+t));return null!==e&&Array.isArray(e)&&e.length?e.length:0},pe.setMsgListInfo=(t,e,s)=>{const n=le.sessionStoreListKey+t,r=JSON.parse(sessionStorage.getItem(n)),i=null!==r&&Array.isArray(r)?r:[];if(!(null!==e&&"msg"in e&&5===Object.keys(e).length||null!==s&&Array.isArray(s)&&s.length))return;const o=null!==s&&Array.isArray(s)&&s.length?[...i,...s]:[...i];null!==e&&"msg"in e&&5===Object.keys(e).length&&o.unshift(e),sessionStorage.setItem(n,JSON.stringify(o))},pe.createMsgItem=(t,e,s,n,r=!1)=>{if(t.chatId!==pe.chatMsgsListWrap.dataset.chatId)return;const i=document.createElement("div"),o=document.createElement("div"),a=document.createElement("div");a.textContent=n?t.senderName:"You",a.dataset.msgId=t.msgId;const c=document.createElement("p");c.textContent=t.msg;const h=document.createElement("div"),u=document.createElement("sub"),l=document.createElement("sub");l.textContent=Be.milliToTime("number"!=typeof t.timeReceived?parseInt(t.timeReceived):t.timeReceived),u.appendChild(l),h.appendChild(u),o.appendChild(a),o.appendChild(c),o.appendChild(h),i.appendChild(o),i.classList.add(n?le.myMsgClass:le.peerMsgClass),r?e.prepend(i):e.append(i)},pe.init=(t,e,s,n,r,i,o,a)=>(a?("user"===i&&ue.getInstance(e,i,!0),le.instance=null,le.chatMsgsList.innerHTML="",le.chatMsgsListWrap,le.chatMsgBody):le.instance||(le.instance=new pe(t,e,s,n,r,i),le.chatMsgsList=document.querySelector(".chat-msg-list")),le.instance),pe.getInst=()=>le.instance?le.instance:null;var me,fe,ge=function(t,e,s,n){return new(s||(s=Promise))((function(r,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):function(t){return t instanceof s?t:new s((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class ye extends R{constructor(t,e,n,r,i,o){super(".chat-msgs","msgs-opts-temp","afterbegin"),this.peerId=t,this.peerName=e,this.chatId=n,this.type=r,this.availability=i,this.fromPeer=o,this.chatToggleUserSection=()=>{this.msgOptsHeads.forEach((t=>{t.addEventListener("click",this.clickMsgOptsSectionHandler)}))},this.clickMsgOptsSectionHandler=t=>{const e=t.target.querySelector("i"),s=t.target.nextElementSibling;e.classList.toggle("chat-msg-opts-head-toggled"),s.classList.toggle("chat-msg-opts-content-toggle")},this.clickGroupRequest=t=>{var e,s;const n=t.target,r=this.createRequestBody(this.peerId,null===(s=null===(e=n.parentElement)||void 0===e?void 0:e.parentElement)||void 0===s?void 0:s.dataset.userId),i=n.dataset.requestAction;if(!i)return;const o=B.patchRequestData(r,i);if(!o.isValid)return console.error("ERROR: client data for group request action is invalid"),void console.error(o.error);n.classList.contains("request-action")&&console.log(i)},this.getGroup=t=>ge(this,void 0,void 0,(function*(){let e;try{e=yield s(f,t)}catch(t){return w.showComp("ERROR: client is unable to fetch group data",t)}B.httpRes(e,"server error occured","client responded with an error for upon request for group information")&&(this.msgGrpInfo=e.data.data)})),(()=>{ge(this,void 0,void 0,(function*(){"group"===this.type&&this.fromPeer&&(yield this.getGroup(t)),this.configureComponent(),this.renderComponent()}))})()}configureComponent(){this.msgOptsHeads=[...document.querySelectorAll(".chat-msg-opts-head")],this.msgOptsMembership=document.querySelector("#chat-msg-opts-memberships"),ye.msgOptsIncomingWrap=document.querySelector(".chat-msg-opts-incoming-wrap"),ye.msgOptsOutgoingWrap=document.querySelector(".chat-msg-opts-outgoing-wrap"),ye.msgOptsAdminsgWrap=document.querySelector(".chat-msg-opts-admins-wrap"),ye.msgOptsMembersWrap=document.querySelector(".chat-msg-opts-members-wrap"),"group"===this.type&&this.msgOptsMembership.addEventListener("click",this.clickGroupRequest),this.chatToggleUserSection()}renderComponent(){const t=[...this.wrapperElement.children][0];this.fromPeer&&"user"===this.type?t.innerHTML="Chat settings is only available for group chats":this.fromPeer?(this.generateRequests(),this.generateAdmins(),this.generateMembers()):t.innerHTML="Chat settings is only available for related peers"}generateRequests(){if(!this.msgGrpInfo||"object"!=typeof this.msgGrpInfo||Object.keys(this.msgGrpInfo).length<1)return;const t=this.msgGrpInfo.requests.incoming,e=this.msgGrpInfo.requests.outgoing;let s;for(s of t)ye.createRequest(s,ye.msgOptsIncomingWrap,"incoming");for(s of e)ye.createRequest(s,ye.msgOptsOutgoingWrap,"outgoing")}generateAdmins(){const t=this.msgGrpInfo.relations;let e;for(e of t)e=Be.relationStrIntToBool(e),e.admin&&ye.createAdmin(e,ye.msgOptsAdminsgWrap)}generateMembers(){const t=this.msgGrpInfo.relations;let e;for(e of t)e=Be.relationStrIntToBool(e),e.admin||ye.createMember(e,ye.msgOptsMembersWrap)}createRequestBody(t,e){return{type:3,recipientId:e,groupId:t}}}me=ye,ye.createRequest=(t,e,s)=>{t=Be.requestStrIntToBool(t);const n=B.requestItem(t,e,s);if(!n.isValid)return w.showComp("ERROR: Request item data is invalid",n.error);const r=document.createElement("div"),i=document.createElement("p"),o=document.createElement("p");let a,c,h;"outgoing"===s?(a=document.createElement("i"),r.classList.add("chat-msg-opts-outgoing-item"),i.textContent=t.accnt_name,a.classList.add("fa-solid","fa-xmark","request-action"),a.dataset.requestAction=O,o.appendChild(a)):"incoming"===s&&(c=document.createElement("i"),h=document.createElement("i"),r.classList.add("chat-msg-opts-incoming-item"),i.textContent=t.accnt_name,c.classList.add("fa-solid","fa-check","request-action"),c.dataset.requestAction=T,h.classList.add("fa-solid","fa-xmark","request-action"),h.dataset.requestAction=_,o.appendChild(c),o.appendChild(h)),r.dataset.userId=t.accnt_id,r.dataset.isGroup=t.isGroup?"true":"false",r.appendChild(i),r.appendChild(o),e.appendChild(r)},ye.createAdmin=(t,e)=>{const s=document.createElement("div");s.classList.add("chat-msg-opts-admin-item");const n=document.createElement("p");n.textContent=t.accnt_name,s.appendChild(n),e.appendChild(s)},ye.createMember=(t,e)=>{const s=document.createElement("div");s.classList.add("chat-msg-opts-member-item");const n=document.createElement("p");n.textContent=t.accnt_name;const r=document.createElement("p"),i=document.createElement("i");i.classList.add("fa-solid","fa-crown");const o=document.createElement("i");o.classList.add("fa-solid","fa-comment-slash");const a=document.createElement("i");a.classList.add("fa-solid","fa-user-slash"),r.appendChild(o),r.appendChild(a),r.appendChild(i),s.appendChild(n),s.appendChild(r),e.appendChild(s)},ye.getInstance=(t,e,s,n,r,i,o)=>(o?(me.instance=null,me.chatMsgsOpts.innerHTML=""):me.instance||(me.instance=new ye(t,e,s,n,r,i),me.chatMsgsOpts=document.querySelector(".chat-msg-opts")),me.instance);class ve extends R{constructor(){super(".chat-msgs-wrap","msgs-temp","afterbegin"),this.configureComponent(),this.renderComponent()}configureComponent(){}renderComponent(){}}fe=ve,ve.getInstance=(t,e,s,n,r,i,o,a)=>(o?fe.getMsgsInstance("deleteId","deleteId","deleteName","deleteChatId",!1,i,a,!0):fe.instance?fe.chatMsgs.dataset.userId!==e&&(fe.getMsgsInstance("deleteId","deleteId","deleteName","deleteChatId",!1,i,a,!0),fe.chatMsgs.innerHTML="",fe.getMsgsInstance(t,e,s,n,r,i,a,!1)):(fe.instance=new ve,fe.chatMsgs=document.querySelector(".chat-msgs"),fe.getMsgsInstance(t,e,s,n,r,i,a,!1)),fe.instance),ve.getMsgsInstance=(t,e,s,n,r,i,o,a)=>{e!==fe.chatMsgs.dataset.userId&&(fe.chatMsgs.dataset.userId=a?"":e,fe.msgOptsInstance=ye.getInstance(e,s,n,i,r,o,a),fe.msgListInstance=pe.init(t,e,s,n,r,i,o,a))};var be,Re=function(t,e,s,n){return new(s||(s=Promise))((function(r,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):function(t){return t instanceof s?t:new s((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class we extends R{constructor(){super(".chat-user-wrap","user-temp","afterbegin"),this.appComp=j.getInstance(),this.chatUserRemoveHandler=t=>{this.chatUserWrap.classList.remove("chat-user-show")},this.chatToggleUserSection=()=>{this.chatUserHeads.forEach((t=>{t.addEventListener("click",this.clickUserSectionHandler)}))},this.clickUserSectionHandler=t=>{const e=t.target.querySelector("i"),s=t.target.nextElementSibling;e.classList.toggle("chat-user-head-toggled"),s.classList.toggle("chat-user-content-toggle")},this.clickUserRequest=t=>{var e,s,n,r,i,o;const a=t.target,c=this.createRequestBody(null===(s=null===(e=a.parentElement)||void 0===e?void 0:e.parentElement)||void 0===s?void 0:s.dataset.isGroup,null===(r=null===(n=a.parentElement)||void 0===n?void 0:n.parentElement)||void 0===r?void 0:r.dataset.userId),h=a.dataset.requestAction;if(!h)return;const u=B.patchRequestData(c,h);if(!u.isValid)return console.error("ERROR: client data for user request action is invalid"),void console.error(u.error);a.classList.contains("request-action")&&(null===(i=a.parentElement)||void 0===i?void 0:i.parentElement)&&(null===(o=Ae.socket)||void 0===o||o.emit(Ae.patchRequestEv,c,h))},this.clickUserPublicHandler=t=>Re(this,void 0,void 0,(function*(){const t={property:this.chatUserPublic.dataset.settingsProperty,value:"true"===this.chatUserPublic.dataset.settingsPublic?"false":"true"},e=B.privacyData(t,A);if(!e.isValid)return w.showComp("ERROR: privacy data for user publicity configuration request is invalid",e.error);let n;try{n=yield s(h,t)}catch(t){return w.showComp("ERROR: client is unable to send request for user privacy configuration",t)}if(!B.httpRes(n,"server is unable to process client's request for privacy configuration","server responded with an error upon client's request for user privacy configuration"))return;const r="true"===this.chatUserPublic.dataset.settingsPublic?"false":"true";this.chatUserPublic.dataset.settingsPublic=r})),this.clickUserAvailabilityHandler=t=>Re(this,void 0,void 0,(function*(){const t={property:this.chatUserAvailability.dataset.settingsProperty,value:"true"===this.chatUserAvailability.dataset.settingsAvailability?"false":"true"},e=B.privacyData(t,M);if(!e.isValid)return w.showComp("ERROR: privacy data for user availability configuration request is invalid",e.error);let n;try{n=yield s(h,t)}catch(t){return w.showComp("ERROR: client is unable to send request for publicity configuration",t)}if(!B.httpRes(n,"server is unable to process client's request for privacy configuration","server responded with an error upon client's request for user privacy configuration"))return;const r="true"===this.chatUserAvailability.dataset.settingsAvailability?"false":"true";this.chatUserAvailability.dataset.settingsAvailability=r})),this.submitPasswordHandler=t=>Re(this,void 0,void 0,(function*(){t.preventDefault();const e=this.getPasswordForm(),n=B.changePasswordForm(e);if(!n.isValid)return w.showComp("ERROR: password data for user security configuration request is invalid",n.error);let r;try{r=yield s(u,e)}catch(t){return w.showComp("ERROR: something went wrong upon client's request for password change",t)}if(B.httpRes(r,"server is unable to process user logout","server responded with an error is unable to send request for user logout")){try{yield this.userLogoutHandler()}catch(t){return w.showComp("ERROR: client is unable to send request for user logout",t)}this.clearPasswordForm()}})),this.userLogoutHandler=t=>Re(this,void 0,void 0,(function*(){let t;try{t=yield s(l)}catch(t){return w.showComp("ERROR: client is unable to send request for user logout",t)}B.httpRes(t,"server is unable to process user logout","server responded with an error upon client's request for user logout")&&(Ae.destroy(),sessionStorage.clear(),this.appComp.appAuth(),this.deleteUserComponents())})),this.configureComponent(),(()=>{Re(this,void 0,void 0,(function*(){try{yield this.getUser(),this.renderComponent()}catch(t){console.error("client is unable to get user data"),console.error(t)}}))})()}configureComponent(){this.chatUserRemove=document.querySelector(".chat-user-name > i"),this.chatUserName=document.querySelector(".chat-user-name > h2"),this.chatUserWrap=document.querySelector(".chat-user-wrap"),this.chatPeerWrap=document.querySelector(".chat-peer-wrap"),this.chatUserHeads=[...document.querySelectorAll(".chat-user-head")],this.chatUserInvites=document.querySelector(".chat-user-invitations"),we.chatUserIncomingWrap=document.querySelector(".chat-user-incoming-items-wrap"),we.chatUserOutgoingWrap=document.querySelector(".chat-user-outgoing-items-wrap"),we.chatUserMutesWrap=document.querySelector(".chat-user-mute-items-wrap"),we.chatUserBlocksWrap=document.querySelector(".chat-user-block-items-wrap"),this.chatUserPublic=document.querySelector(".chat-user-security-public"),this.chatUserAvailability=document.querySelector(".chat-user-security-availability"),this.chatUserForm=document.querySelector(".chat-user-set-password"),this.chatUserPassword=document.querySelector("#set-password"),this.chatUserRePassword=document.querySelector("#set-rePassword"),this.chastUserLogout=document.querySelector(".chat-user-logout"),this.chatUserRemove.addEventListener("click",this.chatUserRemoveHandler),this.chatUserPublic.addEventListener("click",this.clickUserPublicHandler),this.chatUserAvailability.addEventListener("click",this.clickUserAvailabilityHandler),this.chatUserForm.addEventListener("submit",this.submitPasswordHandler),this.chatUserInvites.addEventListener("click",this.clickUserRequest),this.chastUserLogout.addEventListener("click",this.userLogoutHandler),this.chatToggleUserSection()}renderComponent(){this.chatUserName.textContent=this.chatUserInfo.accnt_name,this.chatUserPublic.dataset.settingsProperty=A,this.chatUserPublic.dataset.settingsPublic=`${this.chatUserInfo.privacy.public}`,this.chatUserAvailability.dataset.settingsProperty=M,this.chatUserAvailability.dataset.settingsAvailability=`${this.chatUserInfo.privacy.availability}`,this.generateRequests(),this.generateMuteBlockItem()}getUser(){return Re(this,void 0,void 0,(function*(){let t;try{t=yield s(d)}catch(t){return w.showComp("ERROR: client is unable to fetch user data",t)}B.httpRes(t,"server error occured","client responded with an error for upon request for user information")&&(this.chatUserInfo=t.data.data)}))}getPasswordForm(){return{password:this.chatUserPassword.value,rePassword:this.chatUserRePassword.value}}clearPasswordForm(){this.chatUserPassword.value="",this.chatUserRePassword.value=""}deleteUserComponents(){we.getInstance(!0),Se.getInstance(!0,{}),ve.getInstance("deleteId","deleteId","deleteName","deleteChatId",!1,"user",!0,!1),this.chatUserWrap.innerHTML="",this.chatPeerWrap.innerHTML="",this.chatUserRemoveHandler()}generateRequests(){if(!this.chatUserInfo||"object"!=typeof this.chatUserInfo||Object.keys(this.chatUserInfo).length<1)return;const t=this.chatUserInfo.requests.incoming,e=this.chatUserInfo.requests.outgoing;let s;for(s of t)we.createRequest(s,we.chatUserIncomingWrap,"incoming");for(s of e)we.createRequest(s,we.chatUserOutgoingWrap,"outgoing")}generateMuteBlockItem(){const t=this.chatUserInfo.relations.mutes,e=this.chatUserInfo.relations.blocks;let s,n;for(s of t)we.createMuteBlockItem(s,we.chatUserMutesWrap,0);for(n of e)we.createMuteBlockItem(n,we.chatUserBlocksWrap,1)}createRequestBody(t,e){return{type:"true"===t?2:1,recipientId:"false"===t?e:null,groupId:"true"===t?e:null}}}be=we,we.clickUserMuteBlock=t=>Re(void 0,void 0,void 0,(function*(){var e,n,r,i;const o=t.target,a=o.parentElement.dataset.action,c={recipientId:o.parentElement.dataset.userId,userAction:a,actionValue:!1},h=B.relationAction(c);if(!h.isValid)return w.showComp("ERROR: client request data for user relation patch is invalid",h.error);let u;try{u=yield s(m,c)}catch(t){return w.showComp("ERROR: client is unable to request for patching of user relations",t)}B.httpRes(u,"server is unable to process user's request for patching relations","server responded with an error upon user's request for patching relations")&&(null===(r=null===(n=null===(e=o.parentElement)||void 0===e?void 0:e.parentElement)||void 0===n?void 0:n.parentElement)||void 0===r||r.removeChild(null===(i=o.parentElement)||void 0===i?void 0:i.parentElement),Se.searchPeerHTML(o.parentElement.dataset.userId))})),we.createRequest=(t,e,s)=>{t=Be.requestStrIntToBool(t);const n=B.requestItem(t,e,s);if(!n.isValid)return w.showComp("ERROR: Request item data is invalid",n.error);const r=document.createElement("div"),i=document.createElement("p"),o=document.createElement("p");let a,c,h;"outgoing"===s?(a=document.createElement("i"),r.classList.add("chat-user-outgoing-item"),i.textContent=t.accnt_name,a.classList.add("fa-solid","fa-xmark","request-action"),a.dataset.requestAction=O,o.appendChild(a)):"incoming"===s&&(c=document.createElement("i"),h=document.createElement("i"),r.classList.add("chat-user-incoming-item"),i.textContent=t.accnt_name,c.classList.add("fa-solid","fa-check","request-action"),c.dataset.requestAction=T,h.classList.add("fa-solid","fa-xmark","request-action"),h.dataset.requestAction=_,o.appendChild(c),o.appendChild(h)),r.dataset.userId=t.accnt_id,r.dataset.isGroup=t.isGroup?"true":"false",r.appendChild(i),r.appendChild(o),e.appendChild(r)},we.deleteRequest=(t,e)=>{const s=B.requestDel(t,e);if(!s.isValid)return w.showComp("ERROR: Server send invalid request deletion data",s.error);let n;n=0===e?be.chatUserOutgoingWrap:be.chatUserIncomingWrap,n.removeChild([...n.children].filter((e=>t===e.dataset.userId))[0])},we.createMuteBlockItem=(t,e,s)=>{const n=B.muteBlockItem(t,e,s);if(!n.isValid)return w.showComp("ERROR: Mute item contains invalid data",n.error);const r=document.createElement("div");r.classList.add("chat-user-block-item");const i=document.createElement("p");i.textContent=t.accnt_name;const o=document.createElement("p");o.dataset.userId=t.accnt_id,o.dataset.action=0===s?"mute":"block",o.addEventListener("click",we.clickUserMuteBlock);const a=document.createElement("i");a.classList.add("fa-solid","fa-xmark"),o.appendChild(a),r.appendChild(i),r.appendChild(o),e.appendChild(r)},we.getInstance=t=>(t?(be.instance.chatUserRemoveHandler(),be.instance.chatUserWrap.innerHTML="",be.instance=null):be.instance||(be.instance=new we),be.instance);var Ee,Ie,Ce,qe,Le,ke=function(t,e,s,n){return new(s||(s=Promise))((function(r,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):function(t){return t instanceof s?t:new s((function(e){e(t)}))}(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};class Se extends R{constructor(t){super(".chat-peer-wrap","peer-temp","afterbegin"),this.userData=t,this.skip=0,this.clickUserToggleHandler=t=>{this.chatUserWrap.classList.add("chat-user-show")},this.removeSearchHandler=t=>{this.chatPeerHeadings.classList.remove("chat-lists-search"),this.chatPeerLists.classList.remove("chat-lists-search"),this.chatSearchForm.classList.remove("chat-search-form-search-state")},this.clickSearchHandler=t=>{this.chatPeerHeadings.classList.contains("chat-lists-search")?this.chatSearchInput.value.length||this.removeSearchHandler():(this.chatPeerHeadings.classList.add("chat-lists-search"),this.chatPeerLists.classList.add("chat-lists-search"),this.chatSearchForm.classList.add("chat-search-form-search-state"))},this.submitSearchHandler=t=>ke(this,void 0,void 0,(function*(){t.preventDefault();const e=this.chatSearchTypes.dataset.chatType,n={pattern:this.chatSearchInput.value.trim(),type:"user"===e?0:1,skip:0},r=B.search(n,e);if(!r.isValid)return w.showComp("ERROR: client search data is inavalid",r.error);if(0===n.pattern.length)return void(this.chatSearchList.innerHTML="");let i;try{i=yield s(c,n)}catch(t){return w.showComp("ERROR: client is unable to request for user search",t)}if(!B.httpRes(i,"server is unable to process user search","server responded with an error upon client's request for user search"))return;this.chatSearchList.innerHTML="";const o=i.data.data;o&&"object"==typeof o&&o.length>0&&this.generateSearchItems(o,e)})),this.clickSearchTypesHandler=t=>{const e=t.target;e.classList.contains("chat-search-type")&&e.classList.remove("chat-search-type"),e.nextElementSibling?e.nextElementSibling.classList.remove("chat-search-type"):e.previousElementSibling.classList.remove("chat-search-type"),e.classList.add("chat-search-type"),this.chatSearchTypes.dataset.chatType=e.dataset.chatType},this.clickSearchItemHandler=t=>{const e=t.currentTarget;let s="",n=!1;Se.chatPeerRelationsInfo.map((t=>{t.accnt_id===e.dataset.userId&&(s=t.chat_id,n=!0)})),ve.getInstance(this.userData.act_id.accnt_id,e.dataset.userId,e.querySelector("h3").textContent,s,n,e.dataset.chatType,!1,n)},this.undoEventClickHandler=t=>{const e=t.target;"click"===t.type&&(0!==t.button||e===this.chatSearchInput||e.classList.contains("chat-search-type-group")||e.classList.contains("chat-search-type-user")||this.chatPeerHeadings.classList.contains("chat-lists-search")&&!this.chatSearchInput.value.length&&this.removeSearchHandler())},this.undoEventKeyHandler=t=>{},this.clickPeerItemHandler=t=>{const e=t.currentTarget.parentElement;ve.getInstance(this.userData.act_id.accnt_id,e.dataset.userId,e.querySelector("h3").textContent,e.dataset.chatId,!0,e.dataset.chatType,!1,!0)},this.clickPeerListHandler=t=>{let e=t.target;if(e.classList.contains("chat-contact-tooltip")){e.classList.contains("fa-ellipsis-vertical")&&(e=e.parentElement);const t=e.querySelector(".chat-contact-tooltip-content");if(t.classList.contains("chat-contact-tooltip-show"))t.classList.remove("chat-contact-tooltip-show");else{const e=[...Se.chatPeerList.querySelectorAll(".chat-contact-tooltip-content")];e.length>0&&e.forEach((t=>{t.classList.remove("chat-contact-tooltip-show")})),t.classList.add("chat-contact-tooltip-show")}}},this.fetchTopMsgs=()=>ke(this,void 0,void 0,(function*(){let t,e;for(e of Se.chatPeerRelationsHTML){try{t=yield s(b,e.dataset.chatId)}catch(t){w.showComp("ERROR: client is unable to fetch top chat message",t)}B.httpRes(t,"server error occured","client responded with an error for upon request for top chat message"),e.querySelector("p").textContent=t.data.data.msg}})),(()=>{ke(this,void 0,void 0,(function*(){try{yield this.getUserContacts(),this.configureComponent(),this.renderComponent(),this.connectToSocketRooms()}catch(t){w.showComp("ERROR: client is unable to request user relations",t)}}))})()}configureComponent(){this.chatUserWrap=document.querySelector(".chat-user-wrap"),this.chatUserToggle=document.querySelector(".chat-user-toggle > i"),this.chatPeerHeadings=document.querySelector(".chat-lists-head"),this.chatPeerLists=document.querySelector(".chat-lists"),this.chatSearchForm=document.querySelector(".chat-search-form"),this.chatRemoveSearch=document.querySelector(".chat-remove-search"),this.chatSearchTypes=document.querySelector(".chat-search-types"),this.chatSearchInput=document.getElementById("chat-search-input"),this.chatSearchList=document.querySelector(".chat-search-list"),Se.chatPeerList=document.querySelector(".chat-contact-list"),this.chatApp=document.querySelector(".chat-app"),this.chatUserToggle.addEventListener("click",this.clickUserToggleHandler),this.chatRemoveSearch.addEventListener("click",this.removeSearchHandler),this.chatSearchInput.addEventListener("click",this.clickSearchHandler),this.chatSearchInput.addEventListener("input",this.submitSearchHandler),this.chatSearchForm.addEventListener("submit",this.submitSearchHandler),this.chatSearchTypes.addEventListener("click",this.clickSearchTypesHandler),Se.chatPeerList.addEventListener("click",this.clickPeerListHandler),document.addEventListener("click",this.undoEventClickHandler),document.addEventListener("keypress",this.undoEventKeyHandler)}renderComponent(){var t;null===(t=this.chatSearchTypes.querySelector(".chat-search-type-user"))||void 0===t||t.classList.add("chat-search-type"),this.chatSearchTypes.dataset.chatType=k,this.generateContactItems()}getUserContacts(){return ke(this,void 0,void 0,(function*(){const t=this.createRelBody();let e,n;try{e=yield s(p,t)}catch(t){return w.showComp("ERROR: client is unable to request user relations",t)}if(B.httpRes(e,"server is unable to process request for user relations","server responded with an error upon client's request for user relations"))for(n of e.data.data)Se.chatPeerRelationsInfo.push(Be.relationStrIntToBool(n))}))}connectToSocketRooms(){var t;const e=Se.chatPeerRelationsInfo.map((t=>t.chat_id));null===(t=Ae.socket)||void 0===t||t.emit(Ae.joinRoomsEv,e,(t=>{console.log(t)}))}generateSearchItems(t,e){let s;for(s of t)this.createSearchItem(s,e)}createSearchItem(t,e){const s=B.searchItem(t);if(!s.isValid)return w.showComp("ERROR: search item data is invalid",s.error);const n=document.createElement("div"),r=document.createElement("h3"),i=document.createTextNode(t.act_name);n.classList.add("chat-search-item"),n.dataset.userId=t.accnt_id,n.dataset.chatType=e,n.dataset.availability=`${t.availability}`,r.appendChild(i),n.appendChild(r),n.addEventListener("click",this.clickSearchItemHandler),this.chatSearchList.insertAdjacentElement("beforeend",n)}generateContactItems(){let t;for(t of Se.chatPeerRelationsInfo)Se.createRelationItem(t);if(Se.chatPeerRelationsInfo.length){const t=Se.chatPeerRelationsInfo[0];ve.getInstance(this.userData.act_id.accnt_id,t.accnt_id,t.accnt_name,t.chat_id,!0,t.type,!1,!0)}}createRelBody(){return{contactType:"contact",chatType:"user",groupId:null,skip:this.skip}}}Ee=Se,Se.chatPeerRelationsInfo=[],Se.chatPeerRelationsHTML=[],Se.clickContactActionHandler=t=>ke(void 0,void 0,void 0,(function*(){var e,n,r,i;const o=t.target,a=o.dataset.contactAct;let c,h;const u=null===(n=null===(e=o.parentElement)||void 0===e?void 0:e.parentElement)||void 0===n?void 0:n.parentElement,l={recipientId:u.dataset.userId,userAction:a,actionValue:!0};if(h=B.relationAction(l),!h.isValid)return w.showComp("ERROR: User data for requesting user relation action is invalid",h.error);if("archive"===a)return void Se.chatPeerList.removeChild(u);try{c=yield s(m,l)}catch(t){return w.showComp("ERROR: client is unable to request relation action",t)}if(!B.httpRes(c,"server is unable to process request for user action","server responded with an error upon client's request for relation action"))return;const d={accnt_id:u.dataset.userId,accnt_name:null===(r=[...u.children][0].querySelector("h3"))||void 0===r?void 0:r.textContent,type:u.dataset.chatType,chat_id:"pseudo",admin:!1,archive:"true"===u.dataset.isArchived,block:"true"===u.dataset.isBlocked,mute:"true"===u.dataset.isMuted,bump:0};if("block"===a&&"group"===d.type){let t=JSON.parse(sessionStorage.getItem(ue.grpSessionStoreName));t=t.filter((t=>d.accnt_id!==t.accnt_id)),sessionStorage.removeItem(ue.grpSessionStoreName),sessionStorage.setItem(ue.grpSessionStoreName,JSON.stringify(t))}"mute"===a?(u.querySelector("p").textContent="-----",we.createMuteBlockItem(d,we.chatUserMutesWrap,0)):we.createMuteBlockItem(d,we.chatUserBlocksWrap,1),null===(i=o.parentElement)||void 0===i||i.removeChild(o)})),Se.createRelationItem=t=>{t=Be.relationStrIntToBool(t),B.contactItem(t);const e=document.createElement("div");e.classList.add("chat-contact-item"),e.dataset.userId=t.accnt_id,e.dataset.chatId=t.chat_id,e.dataset.isMuted=`${t.mute}`,e.dataset.isBlocked=`${t.block}`,e.dataset.isArchived=`${t.archive}`,e.dataset.chatType=t.type;const s=document.createElement("div");s.classList.add("chat-contact-info");const n=document.createElement("h3");n.textContent=t.accnt_name;const r=document.createElement("p");t.mute?r.textContent="------":r.textContent="Greet your new peer.",s.appendChild(n),s.appendChild(r);const i=document.createElement("div");i.classList.add("chat-contact-tooltip");const o=document.createElement("i");o.classList.add("fa-solid","fa-ellipsis-vertical");const a=document.createElement("div");if(a.classList.add("chat-contact-tooltip-content"),!t.block){const t=document.createElement("p");t.textContent=q,t.dataset.contactAct=q,a.appendChild(t)}if(!t.mute){const t=document.createElement("p");t.textContent=L,t.dataset.contactAct=L,a.appendChild(t)}const c=document.createElement("p");return c.textContent=C,c.dataset.contactAct=C,a.appendChild(c),a.addEventListener("click",Ee.clickContactActionHandler),i.appendChild(o),i.appendChild(a),e.appendChild(s),e.appendChild(i),s.addEventListener("click",Ee.instance.clickPeerItemHandler),Ee.chatPeerList.appendChild(e),Ee.chatPeerRelationsHTML.push(e),e},Se.updatePeerListHTML=(t,e)=>{const s=Ee.searchPeerInfo(t.chat_id);let n,r;s&&"chat_id"in s?(r=!0,n=Ee.searchPeerHTML(t.chat_id),Ee.chatPeerRelationsHTML[0]!==n&&(Ee.chatPeerRelationsHTML=Ee.chatPeerRelationsHTML.filter((e=>e.dataset.chatId!==t.chat_id)),Ee.chatPeerRelationsInfo=Ee.chatPeerRelationsInfo.filter((e=>e.chat_id!==t.chat_id)))):(r=!1,n=Ee.createRelationItem(t)),null!==e&&(n.querySelector("h3 + p").textContent=Be.milliToTime(null==e?void 0:e.timeReceived)+" - "+(null==e?void 0:e.msg)),Ee.chatPeerRelationsHTML[0]!==n&&(Ee.chatPeerRelationsHTML.unshift(n),Ee.chatPeerRelationsInfo.unshift(t),Ee.chatPeerList.removeChild(n),Ee.chatPeerList.prepend(n))},Se.searchPeerInfo=t=>Se.chatPeerRelationsInfo.find((e=>e.chat_id===t)),Se.searchPeerHTML=t=>{let e;return Ee.chatPeerRelationsHTML.forEach((s=>{s.dataset.chatId===t&&(e=s)})),e},Se.getInstance=(t,e)=>(t?(Ee.instance=null,Ee.chatPeerRelationsInfo.length=0,Ee.chatPeerRelationsHTML.length=0):Ee.instance||(Ee.instance=new Se(e)),Ee.instance);class Te{constructor(){}}Ie=Te,Te.postMessageR=t=>{pe.createMsgItem(t,pe.getChatMsgBody(),pe.getChatMsgsListWrap(),1),Se.updatePeerListHTML({accnt_id:t.senderId,chat_id:t.chatId},t),null!==pe.getInst()&&pe.getInst().incrMsgsListCnt(),pe.setMsgListInfo(pe.chatMsgsListWrap.dataset.chatId,t,null)},Te.getInst=()=>(Ie.inst||(Ie.inst=new Te),Ie.inst);class _e{constructor(){}}Ce=_e,_e.postRequestR=(t,e)=>{(t=Be.requestStrIntToBool(t)).isGroup||we.createRequest(t,0===e?we.chatUserOutgoingWrap:we.chatUserIncomingWrap,0===e?"outgoing":"incoming")},_e.patchRequestR=(t,e,s)=>{"user"===s.relItem.type&&we.deleteRequest(t,e),B.approveData(s).isValid&&B.contactItem(s.relItem).isValid&&Se.updatePeerListHTML(s.relItem)},_e.getInst=()=>(Ce.inst||(Ce.inst=new _e),Ce.inst);class Oe{}qe=Oe,Oe.patchRelation=()=>{},Oe.getInst=()=>(qe.inst||(qe.inst=new Oe),qe.inst);class Ae{constructor(){}}Le=Ae,Ae.postRequestEv="postRequest",Ae.postRequestRev="postRequestR",Ae.patchRequestEv="patchRequest",Ae.patchRequestRev="patchRequestR",Ae.patchRelationEv="patchRelation",Ae.patchRelationRev="patchRelationR",Ae.postMessageEv="postMessage",Ae.postMessageRev="postMessageR",Ae.joinRoomsEv="joinRooms",Ae.serverErrRev="serverErrR",Ae.init=()=>{Le.socket=ae("https://localhost:8000"),Ae.get(),Ae.configureSocket(Le.socket)},Ae.configureSocket=t=>{Ae.configConnEv(t),Ae.configRequestEv(t),Ae.configRelationEv(t),Ae.configMessageEv(t),Ae.configErrEv(t)},Ae.configConnEv=t=>{t.on("connect",(()=>{console.log(`${Le.socket.id} contected to server`)}))},Ae.configRequestEv=t=>{t.on(Le.postRequestRev,_e.postRequestR),t.on(Le.patchRequestRev,_e.patchRequestR)},Ae.configRelationEv=t=>{t.on(Le.patchRelationEv,Oe.patchRelation)},Ae.configMessageEv=t=>{t.on(Le.postMessageRev,Te.postMessageR)},Ae.configErrEv=t=>{t.on(Le.serverErrRev,(t=>{console.error(t)}))},Ae.destroy=()=>{Le.socket.disconnect(),console.log(`${Le.socket.id} user disconnected to server`),Le.socket=null},Ae.get=()=>(Le.instance||(Le.instance=new Ae),Le.instance);var Me,Pe;class Be{constructor(){}}Me=Be,Be.requestStrIntToBool=t=>("0"===t.isGroup||0===t.isGroup?t.isGroup=!1:"1"!==t.isGroup&&1!==t.isGroup||(t.isGroup=!0),t),Be.relationStrIntToBool=t=>("0"===t.admin||0===t.admin?t.admin=!1:"1"!==t.admin&&1!==t.admin||(t.admin=!0),"0"===t.block||0===t.block?t.block=!1:"1"!==t.block&&1!==t.block||(t.block=!0),"0"===t.mute||0===t.mute?t.mute=!1:"1"!==t.mute&&1!==t.mute||(t.mute=!0),"0"===t.archive||0===t.archive?t.archive=!1:"1"!==t.archive&&1!==t.archive||(t.archive=!0),t.bump=parseInt(t.bump),t),Be.milliToTime=t=>{const e=new Date(t),s=e.getHours(),n=e.getMinutes(),r=e.getSeconds(),i=s%12;return`${i<10?`0${i}`:i}:${n<10?`0${n}`:n}:${r<10?`0${r}`:r} ${1===Math.ceil(s/12)?"AM":"PM"}`},Be.logUser=t=>{return e=void 0,n=void 0,i=function*(){const t=j.getInstance();let e;try{if(e=yield s(a),!e.data)return void w.showComp("ERROR: upon user's request for authentication");if(!(e.data.statusCode>=200&&e.data.statusCode<400))return t.appAuth(),void w.showComp("ERROR: server responded with an error from client's authentication",JSON.stringify(e.data.data));Se.getInstance(!1,e.data.data),we.getInstance(!1),t.appUser(),Ae.init()}catch(t){console.error("ERROR: client is unable to request for authentication"),console.error(t)}},new((r=void 0)||(r=Promise))((function(t,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(e){e.done?t(e.value):function(t){return t instanceof r?t:new r((function(e){e(t)}))}(e.value).then(o,a)}c((i=i.apply(e,n||[])).next())}));var e,n,r,i},Be.getInst=()=>(Me.inst||(Me.inst=new Be),Me.inst);class xe extends R{constructor(){super(".chat-app","chat-temp","afterbegin")}configureComponent(){}renderComponent(){}}Pe=xe,xe.getInstance=()=>(Pe.instance||(Pe.instance=new xe),Pe.instance),H.getInstance(),xe.getInstance(),w.getInstance(),window.addEventListener("load",Be.logUser)})();